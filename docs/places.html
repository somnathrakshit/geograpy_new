---

title: geograpy3.places


keywords: fastai
sidebar: home_sidebar

summary: "Takes a list of place names and works place designation (country, region, etc) and relationships between places (city is inside region is inside country, etc)"
description: "Takes a list of place names and works place designation (country, region, etc) and relationships between places (city is inside region is inside country, etc)"
nb_path: "places.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: places.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="PlaceContext" class="doc_header"><code>class</code> <code>PlaceContext</code><a href="https://github.com/somnathrakshit/geograpy_new/tree/master/geograpy_new/places.py#L11" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>PlaceContext</code>(<strong><code>place_names</code></strong>:<code>list</code>, <strong><code>setAll</code></strong>:<code>bool</code>=<em><code>True</code></em>, <strong><code>correctMisspelling</code></strong>:<code>bool</code>=<em><code>False</code></em>) :: <a href="/geograpy_new/locator.html#Locator"><code>Locator</code></a></p>
</blockquote>
<p>Adds context information to a place name</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">PlaceContext</span><span class="p">(</span><span class="n">Locator</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Adds context information to a place name</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">place_names</span><span class="p">:</span><span class="nb">list</span><span class="p">,</span> <span class="n">setAll</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">correctMisspelling</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Constructor</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            place_names:</span>
<span class="sd">                list: The place names to check</span>
<span class="sd">            setAll:</span>
<span class="sd">                boolean: True if all context information should immediately be set</span>
<span class="sd">            db_file:</span>
<span class="sd">                    string: Path to the database file to be used - if None the default &quot;locs.db&quot; will be used</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">correctMisspelling</span><span class="o">=</span><span class="n">correctMisspelling</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">places</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalizePlaces</span><span class="p">(</span><span class="n">place_names</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">setAll</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setAll</span><span class="p">()</span>
            
    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return a string representation of me</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">text</span><span class="o">=</span> <span class="s2">&quot;countries=</span><span class="si">%s</span><span class="se">\n</span><span class="s2">regions=</span><span class="si">%s</span><span class="se">\n</span><span class="s2">cities=</span><span class="si">%s</span><span class="se">\n</span><span class="s2">other=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">countries</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">regions</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">cities</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">other</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">text</span>

    <span class="k">def</span> <span class="nf">getRegions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">countryName</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">list</span><span class="p">:</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        get a list of regions for the given countryName</span>
<span class="sd">        countryName(str): the countryName to check</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">regions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">queryString</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;SELECT r.*  FROM </span>
<span class="s2">            COUNTRIES c </span>
<span class="s2">            JOIN regions r ON r.countryId=c.wikidataid</span>
<span class="s2">            WHERE c.name=(?)&quot;&quot;&quot;</span>
        <span class="n">params</span><span class="o">=</span><span class="p">(</span><span class="n">countryName</span><span class="p">,)</span>
        <span class="n">regionRecords</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sqlDB</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">queryString</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">regionRecord</span> <span class="ow">in</span> <span class="n">regionRecords</span><span class="p">:</span>
            <span class="n">region</span><span class="o">=</span><span class="n">Region</span><span class="o">.</span><span class="n">fromRecord</span><span class="p">(</span><span class="n">regionRecord</span><span class="p">)</span>
            <span class="n">regions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">regions</span>

    <span class="k">def</span> <span class="nf">get_region_names</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">countryName</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">list</span><span class="p">:</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        get region names for the given country</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            countryName(str): the name of the country</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">correctMisspelling</span><span class="p">:</span>
            <span class="n">countryName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">correct_country_misspelling</span><span class="p">(</span><span class="n">countryName</span><span class="p">)</span>
        <span class="n">regionOfCountryQuery</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;SELECT name </span>
<span class="s2">        FROM regions </span>
<span class="s2">        WHERE countryId IN (</span>
<span class="s2">            SELECT wikidataid </span>
<span class="s2">            FROM countries</span>
<span class="s2">            WHERE name LIKE (?)</span>
<span class="s2">            OR wikidataid IN (</span>
<span class="s2">                SELECT wikidataid </span>
<span class="s2">                FROM country_labels </span>
<span class="s2">                WHERE label LIKE (?)</span>
<span class="s2">            )</span>
<span class="s2">        )&quot;&quot;&quot;</span>
        <span class="n">regionRecords</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sqlDB</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">regionOfCountryQuery</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">(</span><span class="n">countryName</span><span class="p">,</span><span class="n">countryName</span><span class="p">,))</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">r</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">regionRecords</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">setAll</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Set all context information</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_countries</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_regions</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_cities</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_other</span><span class="p">()</span>
        
    <span class="k">def</span> <span class="nf">set_countries</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        get the country information from my places</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">countries</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">place</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">places</span><span class="p">:</span>
            <span class="n">country</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">getCountry</span><span class="p">(</span><span class="n">place</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">country</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">countries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">country</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">country_mentions</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">countries</span><span class="p">)</span><span class="o">.</span><span class="n">most_common</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">countries</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">countries</span><span class="p">))</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">set_regions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        get the region information from my places (limited to the already identified countries)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">regions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">country_regions</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">region_names</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">countries</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_countries</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">region_match</span><span class="p">(</span><span class="n">place_name</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">region_name</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">bool</span><span class="p">:</span>
            <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Tests the similarity of the given strings after removing non ascii characters.</span>
<span class="sd">            Args:</span>
<span class="sd">                place_name(str): Place name</span>
<span class="sd">                region_name(str): valid region name to test against</span>
<span class="sd">            Returns:</span>
<span class="sd">                True if the similarity of both values is greater equals 80%. Otherwise False</span>
<span class="sd">            &#39;&#39;&#39;</span>
            <span class="k">return</span> <span class="n">fuzzy_match</span><span class="p">(</span><span class="n">remove_non_ascii</span><span class="p">(</span><span class="n">place_name</span><span class="p">),</span>
                               <span class="n">remove_non_ascii</span><span class="p">(</span><span class="n">region_name</span><span class="p">))</span>

        <span class="k">def</span> <span class="nf">is_region</span><span class="p">(</span><span class="n">place_name</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">region_names</span><span class="p">:</span><span class="nb">list</span><span class="p">):</span>
            <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Filters out the regions that are not similar to the given place_name</span>
<span class="sd">            Args:</span>
<span class="sd">                place_name(str): place name to check against the regions</span>
<span class="sd">                region_names(list): List of valid region names</span>
<span class="sd">            Returns:</span>
<span class="sd">                List of regions that are similar to the given place_name</span>
<span class="sd">            &#39;&#39;&#39;</span>
            <span class="k">return</span> <span class="nb">any</span><span class="p">([</span><span class="n">region_match</span><span class="p">(</span><span class="n">place_name</span><span class="p">,</span> <span class="n">rn</span><span class="p">)</span> <span class="k">for</span> <span class="n">rn</span> <span class="ow">in</span> <span class="n">region_names</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">country</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">countries</span><span class="p">:</span>
            <span class="n">region_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_region_names</span><span class="p">(</span><span class="n">country</span><span class="p">)</span>
            <span class="n">matched_regions</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">places</span><span class="p">)</span> <span class="k">if</span> <span class="n">is_region</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">region_names</span><span class="p">)]</span>

            <span class="n">regions</span> <span class="o">+=</span> <span class="n">matched_regions</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">country_regions</span><span class="p">[</span><span class="n">country</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">matched_regions</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">region_mentions</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">regions</span><span class="p">)</span><span class="o">.</span><span class="n">most_common</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">regions</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">regions</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">set_cities</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        set the cities information</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cities</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">country_cities</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">address_strings</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">countries</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_countries</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">regions</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_regions</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">db_has_data</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">populate_db</span><span class="p">()</span>
        <span class="c1"># ToDo: Duplicate with Locator.city_for_name e.g. extend method to support multiple names</span>
        <span class="n">placesWithoutDuplicates</span><span class="o">=</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">places</span><span class="p">)</span>
        <span class="n">params</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;?&quot;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">placesWithoutDuplicates</span><span class="p">))</span>
        <span class="n">query</span><span class="o">=</span><span class="s2">&quot;SELECT * FROM CityLookup WHERE name IN (&quot;</span> <span class="o">+</span> <span class="n">params</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span>
        <span class="n">cityLookupRecords</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sqlDB</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span><span class="nb">list</span><span class="p">(</span><span class="n">placesWithoutDuplicates</span><span class="p">))</span>
        <span class="n">cityLookupRecords</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">cityRecord</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">cityRecord</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;pop&#39;</span><span class="p">))</span> <span class="k">if</span> <span class="n">cityRecord</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;pop&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mf">0.0</span> <span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">cityLookupRecord</span> <span class="ow">in</span> <span class="n">cityLookupRecords</span><span class="p">:</span>
            <span class="n">city</span><span class="o">=</span><span class="n">City</span><span class="o">.</span><span class="n">fromCityLookup</span><span class="p">(</span><span class="n">cityLookupRecord</span><span class="p">)</span>
           
            <span class="k">if</span> <span class="n">city</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cities</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">city</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

            <span class="n">countryName</span><span class="o">=</span><span class="n">city</span><span class="o">.</span><span class="n">country</span><span class="o">.</span><span class="n">name</span>
            <span class="k">if</span> <span class="n">countryName</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">countries</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">countries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">countryName</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">country_mentions</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">countryName</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">countryName</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">country_cities</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">country_cities</span><span class="p">[</span><span class="n">countryName</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">if</span> <span class="n">city</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">country_cities</span><span class="p">[</span><span class="n">countryName</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">country_cities</span><span class="p">[</span><span class="n">countryName</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">city</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="n">regionName</span><span class="o">=</span><span class="n">city</span><span class="o">.</span><span class="n">region</span><span class="o">.</span><span class="n">name</span>
                <span class="k">if</span> <span class="n">countryName</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">country_regions</span> <span class="ow">and</span> <span class="n">regionName</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">country_regions</span><span class="p">[</span><span class="n">countryName</span><span class="p">]:</span>
                    <span class="n">address</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">city</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">regionName</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">countryName</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">address_strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">address</span><span class="p">)</span>

        <span class="n">all_cities</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">places</span> <span class="k">if</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cities</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">city_mentions</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">all_cities</span><span class="p">)</span><span class="o">.</span><span class="n">most_common</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">set_other</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">cities</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_cities</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">unused</span><span class="p">(</span><span class="n">place_name</span><span class="p">):</span>
            <span class="n">places</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">countries</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cities</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">regions</span><span class="p">]</span>
            <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">correct_country_misspelling</span><span class="p">(</span><span class="n">place_name</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">l</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">places</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">other</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">places</span> <span class="k">if</span> <span class="n">unused</span><span class="p">(</span><span class="n">p</span><span class="p">)]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

